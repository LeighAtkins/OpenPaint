<!-- 34075056-bbce-4c9d-a8b7-997ff90e8912 2c9519b3-8b3e-499a-888c-e7050badc302 -->
# AI Pipeline Enhancements

## Classification Reliability

- Update `js/ai-draw-bot.js` to capture a lossy JPEG snapshot or hashed handle for the currently selected image and send it with `classifyImage` requests.
- Extend the Cloudflare worker `workers/sofa-classify.js` (or equivalent) to accept `{imageHash, imageData}` and return a canonical viewpoint, tags, and confidence sourced from the new payload.
- In `js/ai-draw-bot-integration.js`, automatically set `aiViewpointSelect` and `imageTags[label]` based on the response, surface confidence UI, and allow manual override while keeping the worker result as default.

## Measurement Prediction Flow

- Design a `predictMeasurements` method in `js/ai-draw-bot.js` that calls a new worker endpoint (e.g., `workers/draw-bot.js` enhancement) with `{viewpoint, imageHash}`.
- Update the worker to output prioritized `{code, stroke, confidence}` entries so the client can pre-populate A1â€“A4 and render ghost strokes without manual dropdown selection.
- Adjust `js/ai-draw-bot-integration.js` so the AI panel shows predicted measurements, enables accept/dismiss per suggestion, and falls back to manual selection if the worker has no confident result.

## Feedback With Visual Context

- When queuing feedback in `public/js/paint.js` and `js/ai-draw-bot-integration.js`, attach either the snapshot (base64) or the previously generated image hash plus canvas metadata.
- Update `workers/feedback.js` to store the additional imagery reference in KV/R2 and deduplicate entries via hash to avoid redundant uploads.
- Enhance `workers/promote-feedback.js` (and related aggregation utilities) to retrieve the stored imagery when aggregating strokes, ensuring promoted exemplars can be visually validated before overwriting production data.

## Documentation & Testing

- Document the new pipeline and required environment settings in `docs/ai-draw-bot-setup.md` and `docs/ai-feedback-getting-started.md`.
- Add unit/integration tests (e.g., under `tests/unit/ai-svg-generation.test.js` or new files) covering classification auto-selection, measurement prediction fallbacks, and feedback payload validation.

### To-dos

- [ ] Implement auto viewpoint classification flow
- [ ] Add measurement prediction + UI integration
- [ ] Capture image data in feedback + worker updates
- [ ] Update docs and add regression tests