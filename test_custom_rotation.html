<!DOCTYPE html>
<html>
<head>
    <title>Custom Label Rotation Test</title>
    <script>
        // Test the custom label rotation bug
        async function testCustomLabelRotation() {
            console.log("=== Starting Custom Label Rotation Test ===");
            
            // Wait for the OpenPaint application to load
            if (!window.runCustomLabelRotationTest) {
                console.error("runCustomLabelRotationTest function not found. Make sure OpenPaint is loaded.");
                return;
            }
            
            // First, let's check what custom positions exist for blank_canvas
            console.log("=== DEBUG: Checking existing custom positions ===");
            console.log("window.customLabelPositions structure:", window.customLabelPositions);
            console.log("blank_canvas positions:", window.customLabelPositions?.blank_canvas);
            
            // Let's also check if there are any custom positions being used
            const currentImg = window.currentImageLabel || 'blank_canvas';
            console.log("Current image label:", currentImg);
            
            if (window.customLabelPositions?.[currentImg]) {
                console.log(`Custom positions for ${currentImg}:`, window.customLabelPositions[currentImg]);
            } else {
                console.log(`No custom positions found for ${currentImg}`);
            }
            
            try {
                const result = await window.runCustomLabelRotationTest('Image 1');
                
                console.log("\n=== TEST RESULTS ===");
                console.log("Bug detected:", result.bugDetected);
                console.log("Custom labels affected:", result.customLabelsAffected.length);
                console.log("All labels:", result.allLabels);
                
                if (result.bugDetected) {
                    console.log("\n✅ SUCCESS: The test detected the rotation bug!");
                    console.log("Custom labels that didn't rotate with their strokes:");
                    result.customLabelsAffected.forEach(label => {
                        console.log(`  - ${label.label}: stayed at (${label.beforePos.x.toFixed(1)}, ${label.beforePos.y.toFixed(1)})`);
                    });
                } else {
                    console.log("\n❌ The bug was not detected - this could mean:");
                    console.log("  1. The rotation fixes are working correctly");
                    console.log("  2. The test needs adjustment");
                }
                
                return result;
            } catch (error) {
                console.error("Test failed with error:", error);
                return null;
            }
        }
        
        // Auto-run the test when the page loads
        window.addEventListener('load', () => {
            console.log("Page loaded, waiting for OpenPaint to initialize...");
            
            // Wait a moment for OpenPaint to load, then run the test
            setTimeout(async () => {
                if (window.runCustomLabelRotationTest) {
                    await testCustomLabelRotation();
                } else {
                    console.error("OpenPaint functions not available. Test cannot run.");
                }
            }, 2000);
        });
    </script>
</head>
<body>
    <h1>Custom Label Rotation Test</h1>
    <p>This test demonstrates the custom label rotation bug where custom labels don't rotate with their strokes.</p>
    <p>Open the browser console to see the test results.</p>
    
    <!-- Embed the OpenPaint application -->
    <iframe src="index.html" width="100%" height="600" style="border: 1px solid #ccc;"></iframe>
    
    <button onclick="testCustomLabelRotation()">Run Test Manually</button>
</body>
</html>